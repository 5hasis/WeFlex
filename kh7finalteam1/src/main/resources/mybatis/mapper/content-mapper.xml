<?xml version="1.0" encoding="UTF-8" ?> 

<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
 
<mapper namespace="content">

	<!-- contentNo 뽑기 (시퀀스번호 미리 추출) -->
	 <select id="sequence" resultType="int">
		select content_seq.nextval from dual
	</select>
	 
	 <!-- 컨텐츠 테이블 등록 -->
	<insert id="insert" parameterType="ContentDto">
		insert into content values(
		#{contentNo} , #{contentName}, #{contentInfo}, #{contentLimit},  #{contentSeries}, 
		#{contentRelease}, #{contentLogo}, 0, 0, #{contentThumbnail}, #{contentType}, #{contentTrailer}, sysdate
		)
	</insert>
	
	<!-- 단일 조회 -->
	<select id="get" parameterType="int" resultType="ContentDto">
		select * from content where content_no = #{contentNo}
	</select>
	
	<!-- 컨텐츠 리스트 -->
	<select id="list" resultType="ContentDto">
		select * from content order by content_no desc
	</select>
	
	<!-- 컨텐츠 삭제 -->
	<delete id="delete" parameterType="int">
		delete from content where content_no=#{contentNo}
	</delete>
	 
	<!-- 컨텐츠 상세정보 수정 -->
	<update id="edit" parameterType="ContentDto">
		update content set 
			content_name=#{contentName}, content_info=#{contentInfo}, content_limit=#{contentLimit}, 
			content_type=#{contentType},  content_release=#{contentRelease},
			content_logo=#{contentLogo}, content_thumbnail=#{contentThumbnail}
		where content_no=#{contentNo}
	</update> 
<<<<<<< HEAD
	 
	<select id="getGenreSlider" parameterType="map" resultType="ContentDto">
		select 
		    CT.*
		from 
		    content CT
		        inner join content_genre CTGR on CT.content_no = CTGR.content_no
		        inner join genre GR on CTGR.genre_no = GR.genre_no
		where GR.genre_name = #{keyword} and CT.content_type = #{contentType}
	</select>
	
	<select id="getContentList" parameterType="map" resultType="ContentListVO">
		select 
		    CT.content_no, CT.content_thumbnail
		from 
		    content CT
		        inner join content_genre CTGR on CT.content_no = CTGR.content_no
		        inner join genre GR on CTGR.genre_no = GR.genre_no
		where GR.genre_name = #{keyword} and CT.content_type = #{contentType}
	</select>
	
	<resultMap type="HoverModalVO" id="hoverModal">
<!-- 		ContentDto 항목을 설정 -->
  		<result column="content_no" property="contentNo"/>  
		
		<!-- GenreDto 항목을 조회하도록 구현 -->
		<collection property="genreList" javaType="java.util.List"
			ofType="GenreDto" column="content_no"
			select="getContentListSub"></collection>
					
	</resultMap>
	
	<!-- 메인 조회 구문(컨텐츠) -->
	<select id="getHoverModalVO" parameterType="int" resultMap="hoverModal">
		select 
		    CT.content_no, CT.content_trailer, CT.content_series, CT.content_limit
		from 
		    content CT		        
		where CT.content_no = #{contentNo}
	</select>
	
	<!-- 서브 조회 구문(장르) : 컨텐츠 번호로 조회 -->
	<select id="getContentListSub" parameterType="int" resultType="GenreDto">
		select gr.* from 
			content_genre cg inner join genre gr on cg.genre_no = gr.genre_no
			where cg.content_no = #{contentNo}
	</select>

=======
	
	<!-- 이번달 컨텐츠 증가 수 -->
	<select id="month-contentCount" resultType="int">
		select count(*) from content
		where content_join between (TRUNC(SYSDATE,'MM')) and SYSDATE
	</select>
	
	<!-- 이번년도 컨텐츠 증가 수 -->
	<select id="year-contentCount" resultType="int">
		select count(*) from content
 		where content_join between (TRUNC(SYSDATE,'YYYY')) and SYSDATE
	</select>
>>>>>>> refs/remotes/origin/main
</mapper>